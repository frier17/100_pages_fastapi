<!DOCTYPE html>
<html><head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <link rel="alternate" type="application/rss+xml" href="https://frier17.github.io/100_pages_fastapi/chapter3/index.xml" title="100 Pages to  FastAPI" />
    <link rel="canonical" href="https://frier17.github.io/100_pages_fastapi/chapter3/">

    <title>
        
        Identifying Routes | 100 Pages to  FastAPI
        
    </title>

    
    <link href="https://frier17.github.io/100_pages_fastapi/css/fontawesome.min.css" rel="stylesheet">

    
    <link rel="stylesheet" href="https://frier17.github.io/100_pages_fastapi/css/ace.min.css">

    

    
    
        
    

</head>
<body><nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow sticky-top" id="navbarMain">
    <div class="container">
        <div>
            
            <img src="https://frier17.github.io/100_pages_fastapi/img/nav_logo.png"/>
            
        </div>
        <div>
            <a class="navbar-brand" href="/100_pages_fastapi">
                100 Pages to  FastAPI
            </a>
        </div>
        
    </div>

</nav>
<div class="container-fluid">
            <div class="row">

                <div class="docs-sidenav order-0 col-12 col-md-3 col-lg-2 col-xl-2 position-sticky border-right"><nav class="navbar navbar-expand-md navbar-light pl-0">
    <button class="navbar-toggler navbar-toggler-right collapsed" type="button" data-toggle="collapse" data-target="#sidenav-left-collapse" aria-controls="sidenav-left-collapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

     <div class="collapse navbar-collapse align-items-start flex-column" id="sidenav-left-collapse">
            <form class="form-inline my-2 my-lg-0 searchbox">
                <input class="form-control mr-sm-2 w-100" data-search-input id="search-by" type="text" placeholder="Search">
            </form>

        

         <ul class="navbar-nav flex-column pt-3">
    <li data-nav-id="/100_pages_fastapi/preface/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/100_pages_fastapi/preface/"><h6>Preface</h6></a>
        
    </li>
    <li data-nav-id="/100_pages_fastapi/table_of_content/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/100_pages_fastapi/table_of_content/"><h6>Table of Content</h6></a>
        
    </li>
    <li data-nav-id="/100_pages_fastapi/chapter1/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/100_pages_fastapi/chapter1/"><h6>Introduction to FastAPI</h6></a>
        
    </li>
    <li data-nav-id="/100_pages_fastapi/chapter2/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/100_pages_fastapi/chapter2/"><h6>The mWallet Project</h6></a>
        
    </li>
    <li data-nav-id="/100_pages_fastapi/chapter3/" class="nav-item my-1 active
        ">
        
        
          <a class="nav-link p-0" href="/100_pages_fastapi/chapter3/"><h6>Identifying Routes</h6></a>
        
    </li>
    <li data-nav-id="/100_pages_fastapi/chapter4/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/100_pages_fastapi/chapter4/"><h6>Application services</h6></a>
        
    </li>
    <li data-nav-id="/100_pages_fastapi/chapter5/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/100_pages_fastapi/chapter5/"><h6>The business domain entities and database layer</h6></a>
        
    </li>
    <li data-nav-id="/100_pages_fastapi/chapter6/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/100_pages_fastapi/chapter6/"><h6>Middleware in FastAPI</h6></a>
        
    </li>
    <li data-nav-id="/100_pages_fastapi/chapter7/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/100_pages_fastapi/chapter7/"><h6>Authorization and Authentication</h6></a>
        
    </li>
    <li data-nav-id="/100_pages_fastapi/chapter8/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/100_pages_fastapi/chapter8/"><h6>Testing</h6></a>
        
    </li>
    <li data-nav-id="/100_pages_fastapi/chapter9/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/100_pages_fastapi/chapter9/"><h6>Resources</h6></a>
        
    </li>
        </ul>
    </div>
</nav>


</div>
                <div class="docs-toc large order-lg-2 order-md-0 order-xs-1 col-12 col-lg-2 col-xl-2 position-sticky border-left"><div class="docs-toc">
	<nav id="TableOfContents">
  <ul>
    <li><a href="#what-the-system-does">What the system does</a></li>
    <li><a href="#how-the-system-works">How the system works</a>
      <ul>
        <li></li>
      </ul>
    </li>
    <li><a href="#a-classic-way-of-defining-routes-in-fasapi">A classic way of defining routes in FasAPI</a></li>
    <li><a href="#using-yaml-file-for-defining-routes">Using YAML file for defining routes</a></li>
  </ul>
</nav>
</div>
</div>
                <div class="main col-12 order-1 col-md-9 col-lg-10 col-xl-8 py-3">
                

<div class="d-flex flex-column">
    <h1 class="js-title">Identifying Routes</h1>
    <div class="d-flex align-items-center">
        
    </div>
</div>

<hr>


<p>Before writing any line of code it is important to state or know exactly what the system will do. Defining what the
system does in a concise statement not longer than two or three sentences is very important to have clarity of purpose.
Programming is a complex psychological act and being precise is a bedrock in building the right system. Added to
building the right system is building the system right. This can be achieved by explaining how the system works. Both
knowing what the system does and how the system does its tasks are important. Taking our project, mWallet as an example.
We can derive the tests cases from knowing &ldquo;what the system does&rdquo; and we can derive our application code base from
knowing &ldquo;how the system works&rdquo;.</p>
<h2 id="what-the-system-does">What the system does</h2>
<blockquote>
<p>mWallet allows users to post their interest in buying or selling cryptocurrencies and allows registered agents (other
users) to fill these orders without the requirement for a direct person-to-person exchange or conversation.</p>
</blockquote>
<p>The statement above gives a direction on what vital services will be available in the mWallet project. The services
identified from the purpose statement are:</p>
<ol>
<li>Users can post order to buy or sell cryptocurrency</li>
<li>Users can satisfy published orders</li>
</ol>
<p>Let&rsquo;s name these key functions of our system the functional requirements. In effect, if our system cannot perform these
tasks we can say we failed to meet our objectives. Having identified these requirements, we can define test cases that
will check if our system can post an order, buy an asset through posted order, sell an asset through posted order, debit
the buyer accordingly while equally crediting the seller of the asset.</p>
<p>Tests can be written as a function prefixed with the word <code>test_</code> or as methods of a class which is often prefixed with
the word <code>test</code>. It is good practice to have all tests in a package named tests. We will be using <code>pytest</code> for the
project and it can run both tests written as classes that extend <code>unittest.TestCase</code> or functions prefixed with <code>test_</code>.</p>






    
    




<div class="position-relative">
    <div class="position-absolute" style="right:0;">
        <button class="btn btn-light" data-clipboard-target="#clipboard_3cd475a1a7">
        Copy
        </button>
    </div>
    <div id="clipboard_3cd475a1a7">
    <div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py3" data-lang="py3"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> unittest <span style="color:#fff;font-weight:bold">import</span> TestCase
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> TestTransaction(TestCase):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> setUp(self) -&gt; <span style="color:#fff;font-weight:bold">None</span>:
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> tearDown(self) -&gt; <span style="color:#fff;font-weight:bold">None</span>:
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> test_place_order(self) -&gt; <span style="color:#fff;font-weight:bold">None</span>:
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> test_satisfy_order(self) -&gt; <span style="color:#fff;font-weight:bold">None</span>:
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> test_transaction_history(self) -&gt; <span style="color:#fff;font-weight:bold">None</span>:
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> test_current_orders(self) -&gt; <span style="color:#fff;font-weight:bold">None</span>:
</span></span><span style="display:flex;"><span>        ...
</span></span></code></pre></div>
    </div>
</div>




<p>The test above can be written as a collection of functions as shown blow.</p>






    
    




<div class="position-relative">
    <div class="position-absolute" style="right:0;">
        <button class="btn btn-light" data-clipboard-target="#clipboard_ed5d6849b0">
        Copy
        </button>
    </div>
    <div id="clipboard_ed5d6849b0">
    <div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py3" data-lang="py3"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">def</span> test_place_order(order: <span style="color:#fff;font-weight:bold">dict</span>) -&gt; <span style="color:#fff;font-weight:bold">None</span>:
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">def</span> test_satisfy_order(transaction_id, order, account, wallet, escrow, ) -&gt; <span style="color:#fff;font-weight:bold">None</span>:
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">def</span> test_transaction_history() -&gt; <span style="color:#fff;font-weight:bold">None</span>:
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">def</span> test_current_orders() -&gt; <span style="color:#fff;font-weight:bold">None</span>:
</span></span><span style="display:flex;"><span>    ...
</span></span></code></pre></div>
    </div>
</div>




<p>Our identified tests will also define the various URLs or Application Programming interfaces (API) endpoints of the
system. If our system is interactive, it is expected to give information or some sort of data to the user. Let’s call
any valid information given by the system a resource. A resource can be a digital file to download, a record from a
database or any web page we wish to share. This resource can be named and accessed via its name. Let us attempt to use
intuitive names to identify resources for our API endpoints.</p>
<p>We will name the following resources which can have associated functions for handling HTTP requests from our users.</p>
<ul>
<li><code>Order Resource</code></li>
<li><code>User Resource</code></li>
<li><code>Asset Resource</code></li>
<li><code>Cryptocurrency Wallet Resource</code></li>
</ul>
<p>🔍</p>
<blockquote>
<p>Details regarding designs of RESTful web applications are beyond this book. A good place to get more information on how
to design a RESTful application is the <a href="https://swagger.io/resources/articles/best-practices-in-api-design/">swagger documentation</a>.</p>
</blockquote>
<p>We now have a collection of tests, a set of resources, but we need to check if these can help us reach our system
requirements. To meet our requirements, certain other questions need to be asked. These questions should provide answers
to how the system works. We will progress on this in the next section.</p>
<h2 id="how-the-system-works">How the system works</h2>
<p>mWallet is a P2P system designed to satisfy orders both online and offline. To achieve this, orders are posted to users
who can then satisfy them as agents. Orders can be fully or partially satisfied, and payments remitted appropriately.
Orders are published to the pool of agents via email and in-app messages. Offline transactions are like real time
transactions but kept open for a longer period.</p>
<p>Offline transactions require an authorization token or passcode from an agent before adding them to the order.
Transaction keys enforce password-less transactions and limit access to wallets and order system for unauthorized or
unregistered agents. Escrow accounts and managed wallets protect users from exposing sensitive banking or wallet
information. This approach is used both by the real time and offline payment system. Details on the system encryption,
random function for selecting agents from a pool, and generating escrow accounts for payments are beyond the scope of
this book. With these guidelines on how the system should work, let us consider how the identified resources can address
the system behaviour.</p>
<ul>
<li>The Order resource can manage both online and offline requests to buy or sell cryptocurrency.</li>
<li>The User resource can manage registration of new system users and agents, the user associated transaction keys, the
user associated bank accounts and user access control.</li>
<li>The Asset resource will manage a list of cryptocurrencies that can be bought or sold on the platform.</li>
<li>The Wallet resource will manage escrow wallets for receiving digital assets.</li>
</ul>
<p>We will now attempt to match a resource to a set of URLs that will enable users to interact with the system.</p>
<ul>
<li>Order
<ul>
<li>Add order</li>
<li>View order</li>
<li>Edit order</li>
<li>Delete order</li>
<li>Add order to pool</li>
<li>Satisfy order</li>
<li>Debit buying party</li>
<li>Credit selling party</li>
<li>List transaction history</li>
<li>Assign order to an agent or agents to satisfy</li>
</ul>
</li>
<li>User
<ul>
<li>Add user (new user registration)</li>
<li>View user</li>
<li>Edit user</li>
<li>Delete user</li>
<li>Assign transaction key to user</li>
</ul>
</li>
<li>Asset
<ul>
<li>List available digital assets</li>
<li>View exchange rate of digital asset to fiat</li>
</ul>
</li>
<li>Wallet
<ul>
<li>Generate address for user</li>
<li>Assign cryptocurrency address or wallet to user</li>
<li>List blockchain transaction history for address</li>
<li>View transaction detail of an address</li>
</ul>
</li>
</ul>
<p><em>The list excludes cryptographic key management, signals or event management, and utility functions used in the
project.</em></p>
<h4 id="ℹ-tips-and-tricks---protecting-the-user-resource">ℹ️ Tips and Tricks - Protecting the user resource</h4>
<blockquote>
<p>An alternative design of resource may include a <code>Transaction</code> resource, <code>Bank Account</code> resource, a <code>User Key</code>
resource, and a <code>User Preference</code> resource. These will enable users to view transactions associated with their orders
and manage various items associated to their profile. In our design approach for this book, user is treated as a special
resource which is only added upon sign up and cannot be viewed, edited, deleted, or updated like other resources.
Special functions and security checks are used to manage the user resource. This approach can also be adopted in a
real-life project to reduce possible cases of updated or deleting a user’s record via unapproved admin users.</p>
</blockquote>
<p>The summary above can be modified as we iterate through the system and get feedback from our target users. However, for
our example, we will keep things simple – possibly very simple to allow the reader to explore alternatives and expand on
the project on their own. From the above list, we can generate a set of URLs. We will save this in a <code>route.yml</code> file
which will be used to dynamically load API routes and permissions later in the project.</p>
<h2 id="a-classic-way-of-defining-routes-in-fasapi">A classic way of defining routes in FasAPI</h2>
<p>A Uniform Resource Locator (URL), a subset of Uniform Resource Identifier (URI), is an identifier for accessing a
resource that is on the Internet and specifies what protocol to use in accessing a resource. A resource could be a web
page or some other file. For the web application in view, URLs will be used to send or receive information from the
system. There are key parts that make up a URL. Some key components of a URL include:</p>
<p><strong>The protocol or scheme</strong>: This will be HTTP/HTTPS for RESTful applications. The protocol determines how computers
communicate. There are several standards like File Transfer Protocol (FTP) for file transfer, Hypertext Transfer
Protocol (HTTP) for web communication etc.</p>
<p><strong>Host name or domain name</strong>: A resource on the internet can be accessed via its unique IP address. However, it is
easier to remember readable names than a set of numbers separated by dots <code>.</code>. Domain names provide a human readable
name that is mapped to an IP address. Example of a domain name is <code>www.yahoo.com</code>.</p>
<p><strong>Port number</strong>: In some cases, a URL may specify a port number by which requests to the server are listened for.
Default port for HTTP servers is 80. This port number does not need to be specified in URLs. In many cases, other port
numbers may be used, example <code>8080</code> or <code>8000</code>.</p>
<p><strong>Path</strong>: The path refers to location on a web server.</p>
<p><strong>Query</strong>. In some cases, extra information may be passed to the web server by using textual fragments. The query
component is used to pass data to the server as a key-value pair after a question mark (?). Multiple query parameters
can be separated using ampersands (&amp;). Example URL:
<code>https://example.com?name=xavier&amp;power=vision</code>.</p>
<p>Designing URLs is important to help convey information to developers and other users of the system. For a REST based
system, it is advisable to use nouns or noun phrases to describe resource URLs.</p>
<p>Routing in FastAPI is simple and very effective. A routing table (a defined list of routes) is passed to the application
when instantiating it. Each route has a corresponding endpoint. Endpoint argument can be any of the following:</p>
<ul>
<li>A regular function, async function, or class method which accepts a single request argument and returns as response.</li>
<li>A class that extends the ASGI interface</li>
</ul>
<p>Conventionally, functions are used to handle responses to a given URL path by using selected
methods (<code>get</code>, <code>put</code>, <code>post</code>, <code>delete</code>) of an instance of the FastAPI <code>APIRouter</code> class as decorators or by calling one
of the routing methods (<code>add_api_route</code>, <code>add_route</code>). The <code>APIRouter</code> class is the base class for handling HTTP
requests and this class extends the Starlette <code>routing.Router</code> class.</p>
<figure><img src="router-structure.png"
         alt="The Router classes used in the mWallet application"/><figcaption>
            <h4>Figure 1</h4><p>The Router classes used in the mWallet application</p>
        </figcaption>
</figure>

<p>The InferringSchemaRouter was designed to extend <code>fastapi_restful.inferring_router.InferringRouter</code> class. This enables the <code>InferringSchemaRouter</code> to automatically convert return types of routing functions to matching Pydantic schemas following the specified database ORM class.</p>






    
    




<div class="position-relative">
    <div class="position-absolute" style="right:0;">
        <button class="btn btn-light" data-clipboard-target="#clipboard_1096246b4d">
        Copy
        </button>
    </div>
    <div id="clipboard_1096246b4d">
    <div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py3" data-lang="py3"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> typing <span style="color:#fff;font-weight:bold">import</span> Any, List
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> fastapi <span style="color:#fff;font-weight:bold">import</span> Depends, APIRouter
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> starlette.status <span style="color:#fff;font-weight:bold">import</span> HTTP_200_OK, HTTP_202_ACCEPTED, HTTP_201_CREATED
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> db.adapters <span style="color:#fff;font-weight:bold">import</span> parse_to_schema
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> schemas.user <span style="color:#fff;font-weight:bold">import</span> UserPreference, UserDevices
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> schemas.util <span style="color:#fff;font-weight:bold">import</span> GenericResponse
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> user <span style="color:#fff;font-weight:bold">import</span> services <span style="color:#fff;font-weight:bold">as</span> user_services
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>web_user_routes = APIRouter()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@web_user_routes.post(<span style="color:#0ff;font-weight:bold">&#39;/user/preference&#39;</span>, status_code=HTTP_200_OK,
</span></span><span style="display:flex;"><span>                      description=<span style="color:#0ff;font-weight:bold">&#39;List all notices sent to this user or notices which the selected user subscribes to.&#39;</span>,
</span></span><span style="display:flex;"><span>                      response_model=GenericResponse)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">def</span> create_user_preference(result_set: Any = Depends(user_services.create_user_preference)) -&gt; UserPreference:
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> parse_to_schema(UserPreference, result_set)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@web_user_routes.delete(<span style="color:#0ff;font-weight:bold">&#39;/user/preference/</span><span style="color:#0ff;font-weight:bold">{preference}</span><span style="color:#0ff;font-weight:bold">&#39;</span>, status_code=HTTP_202_ACCEPTED,
</span></span><span style="display:flex;"><span>                        description=<span style="color:#0ff;font-weight:bold">&#34;Delete a selected user’s preference.&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">def</span> destroy_user_preference(result_set: Any = Depends(user_services.destroy_user_preference)) -&gt; <span style="color:#fff;font-weight:bold">bool</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">bool</span>(result_set)
</span></span></code></pre></div>
    </div>
</div>




<p>The <code>create_user_preference</code> function takes a result_set parameter. This parameter is injected into the function via the
FastAPI <code>Depends</code> class. The <code>Depends</code> class is the FastAPI approach in implementing Dependency Injection (a technique
in dynamically injecting a code into another code making them loosely coupled). The <code>result_set</code> can be any type of
Python data and we do not need to know what type upfront. We will simply pass the <code>result_set</code> to a <code>parse_to_schema</code>
function which has been designed to convert a range of data types into a specified Pydantic model class. In this
example, the <code>result_set</code> will be converted to the <code>UserPreference</code> data type and returned at the end of
the <code>create_user_preference</code> execution cycle. A similar approach is used with the <code>destroy_user_preference</code> which
returns a Boolean.</p>
<p>The server responses to HTTP requests are mapped to corresponding <code>Response</code> objects (classes that extend the
Starlette <code>responses.Response</code> class). Various response types are differentiated mainly by the specified media or mime
which they handle. For example, the <code>JSONResponse</code> class manages the media type of <code>application/json</code> while
the <code>PlainTextResponse</code> manages media type or mime of <code>application/text</code>. Other media types are mapped to their
corresponding <code>Response</code> type or subclass. See Figure 2 below for FastAPI response classes and their hierarchy.
See Table 1 for the various response classes and corresponding mime.</p>
<figure><img src="response-package.png"
         alt="Class Hierachy of FastAPI Response classes"/><figcaption>
            <h4>Figure 2</h4><p>Class Hierachy of FastAPI Response classes</p>
        </figcaption>
</figure>

<p>Response classes of the Starlette responses package. FastAPI uses Starlette’s response package internally to
handle all requests.</p>
<p>The following response classes can be used to manage server responses.</p>



<div class="table table-hover" role="alert">
    <table>
<thead>
<tr>
<th>Class</th>
<th>Media Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Response</td>
<td><code>text/html</code></td>
<td>Base class for managing server responses</td>
</tr>
<tr>
<td>HTMLResponse</td>
<td><code>text/html</code></td>
<td>Specialised class for managing HTML responses</td>
</tr>
<tr>
<td>PlainTextResponse</td>
<td><code>text/plain</code></td>
<td>Specialised class for managing text responses</td>
</tr>
<tr>
<td>JSONResponse</td>
<td><code>application/json</code></td>
<td>Specialised class for managing JSON responses. This is the default response used for most web applications</td>
</tr>
<tr>
<td>RedirectResponse</td>
<td><code>None</code></td>
<td>Specialised class for managing redirects</td>
</tr>
<tr>
<td>StreamingResponse</td>
<td><code>typing.Optional[str]</code> or <code>None</code></td>
<td>Specialised class for managing streaming responses example a live video stream</td>
</tr>
<tr>
<td>FileResponse</td>
<td><code>typing.Optional[str]</code> or <code>None</code></td>
<td>Specialised class for managing file responses example a binary file for download</td>
</tr>
</tbody>
</table>


    <h4>Table 1</h4>
    <p>FastAPI Response classes with associated MIME</p>
</div>

<h2 id="using-yaml-file-for-defining-routes">Using YAML file for defining routes</h2>
<p>When building a web application, thoughts should be given to the design of the URL. FastAPI being built on Starlette
allows developers to use URI templating style to capture path components.</p>






    
    




<div class="position-relative">
    <div class="position-absolute" style="right:0;">
        <button class="btn btn-light" data-clipboard-target="#clipboard_fbbde50eab">
        Copy
        </button>
    </div>
    <div id="clipboard_fbbde50eab">
    <div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py3" data-lang="py3"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>url = <span style="color:#0ff;font-weight:bold">&#39;/user/</span><span style="color:#0ff;font-weight:bold">{id}</span><span style="color:#0ff;font-weight:bold">/payment-receipts&#39;</span>
</span></span></code></pre></div>
    </div>
</div>




<p>Fragments of the URI template can be converted to native Python data types via convertors. There are default convertors
for <code>str</code>, <code>int</code>, <code>float</code>, <code>uuid.UUID</code> data types or a path variable.</p>






    
    




<div class="position-relative">
    <div class="position-absolute" style="right:0;">
        <button class="btn btn-light" data-clipboard-target="#clipboard_9f872219b8">
        Copy
        </button>
    </div>
    <div id="clipboard_9f872219b8">
    <div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py3" data-lang="py3"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>d1 = <span style="color:#0ff;font-weight:bold">&#39;/user/{id: str}/payment-receipts&#39;</span>  <span style="color:#007f7f"># converts id to str type</span>
</span></span><span style="display:flex;"><span>d2 = <span style="color:#0ff;font-weight:bold">&#39;/user/{id: float}/payment-receipts&#39;</span>  <span style="color:#007f7f"># converts id to float type</span>
</span></span><span style="display:flex;"><span>d3 = <span style="color:#0ff;font-weight:bold">&#39;/user/{id: int}/payment-receipts&#39;</span>  <span style="color:#007f7f"># converts id to int type</span>
</span></span></code></pre></div>
    </div>
</div>




<p>Customised convertors can be added to a web application but that is outside the focus of this book. In the mWallet
application, we will define the various URLs using a YAML file. This file will be dynamically loaded into our
application and be used to provide information on each route. Some of the data extracted from the file are shown below.</p>






    
    




<div class="position-relative">
    <div class="position-absolute" style="right:0;">
        <button class="btn btn-light" data-clipboard-target="#clipboard_ab224581a4">
        Copy
        </button>
    </div>
    <div id="clipboard_ab224581a4">
    <div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="font-weight:bold">route</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">name</span>: authentication
</span></span><span style="display:flex;"><span>    description:This resource will manage user activities associated with registration, login, logout, and password reset.
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">base</span>: /authentication
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">endpoints</span>:
</span></span><span style="display:flex;"><span>      - <span style="font-weight:bold">access token</span>:
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">methods</span>: [ <span style="color:#0ff;font-weight:bold">&#39;POST&#39;</span> ]
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">success</span>: Access token generated for user with provided credentials
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">error</span>: Unable to generated access token for the user with provided credentials
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">status</span>: <span style="color:#ff0;font-weight:bold">201</span>
</span></span><span style="display:flex;"><span>          <span style="font-weight:bold">path</span>:
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">url</span>: /token
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold">description</span>: |<span style="color:#0ff;font-weight:bold">
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">              Provide user access token to application services using credentials such as username and password</span>              
</span></span></code></pre></div>
    </div>
</div>




<p>The extract from the YAML file above shows an instance of a registered route for the mWallet application. This example
is for a user authentication service. By using this approach, the development team has a working document that guides
what each API endpoint could handle. This approach also enforces the team to have a clearly defined list of URLs in line
with agreed system purpose statement. Some of the key terms used in the application <code>routes.yml</code> file are shown
below (Table 2). These entries will be used by the custom <code>AppRouter</code> and the FastAPI APIRouter class to pass routes to
the application.</p>



<div class="table table-hover" role="alert">
    <table>
<thead>
<tr>
<th>Route components</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>The name assigned to the route</td>
</tr>
<tr>
<td>description</td>
<td>A short description of the route that will be displayed in the swagger documentation or provide more information about a given item.</td>
</tr>
<tr>
<td>success</td>
<td>Message to display if the route endpoint was executed successfully</td>
</tr>
<tr>
<td>errors</td>
<td>Message to display if the route endpoint fails</td>
</tr>
<tr>
<td>methods</td>
<td>The HTTP methods supported by the route. Typical methods are <code>POST</code>, <code>GET</code>, <code>PUT</code>, or <code>DELETE</code></td>
</tr>
<tr>
<td>path</td>
<td>The URL for this route using URI templating</td>
</tr>
<tr>
<td>endpoints</td>
<td>A collection of routes associated with a given resource. Each endpoint will have its own definition for URL path, path components, success and error messages, HTTP response status, HTTP methods.</td>
</tr>
<tr>
<td>status</td>
<td>HTTP response status to return if the route endpoint was successful.</td>
</tr>
<tr>
<td>url</td>
<td>A nested object that defines the url path, query and path parameters with their associated name and description. A url must be defined for each route.</td>
</tr>
</tbody>
</table>


    <h4>Table 2</h4>
    <p>The route YML file components and description.</p>
</div>

<p>We have seen earlier how to register a route in FastAPI (see Classical way of defining routes in FastAPI). We have also
defined a <code>routes.yml</code> file that is used to register a list of routes with their corresponding components. How can we
use this YML file to dynamically load routes? To answer this, we will need to discuss the <code>AppRouter</code>, and <code>RouteEntry</code>
classes and see how the mWallet uses these in the router package to register all routes of the application.</p>






    
    




<div class="position-relative">
    <div class="position-absolute" style="right:0;">
        <button class="btn btn-light" data-clipboard-target="#clipboard_a815bb5d64">
        Copy
        </button>
    </div>
    <div id="clipboard_a815bb5d64">
    <div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py3" data-lang="py3"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> re
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> urllib.parse <span style="color:#fff;font-weight:bold">import</span> urljoin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> yaml
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> typing <span style="color:#fff;font-weight:bold">import</span> Dict, List, Tuple, Any
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> pydantic <span style="color:#fff;font-weight:bold">import</span> BaseModel
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> stringcase
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>__all__ = <span style="color:#0ff;font-weight:bold">&#39;AppRouter&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;app_routes&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> util <span style="color:#fff;font-weight:bold">import</span> extract_data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> AppRouter:
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f"># Process routes for the app by loading data from routes.yml</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    __slots__ = <span style="color:#0ff;font-weight:bold">&#39;_data&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;_named_routes&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;_routes&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> __init__(self, resources: Dict):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> <span style="color:#0ff;font-weight:bold">&#39;resources&#39;</span> in resources:
</span></span><span style="display:flex;"><span>            data_ = extract_data(<span style="color:#0ff;font-weight:bold">&#39;resources&#39;</span>, resources)
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f"># get names of all routes. Instantiate RouteEntry for each route.</span>
</span></span><span style="display:flex;"><span>            self._data = []
</span></span><span style="display:flex;"><span>            self._named_routes = []
</span></span><span style="display:flex;"><span>            self._routes = []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            self._data = data_.copy()
</span></span><span style="display:flex;"><span>            self._named_routes = [stringcase.spinalcase(stringcase.lowercase(v)) <span style="color:#fff;font-weight:bold">for</span> y in self._data
</span></span><span style="display:flex;"><span>                                  <span style="color:#fff;font-weight:bold">for</span> k, v in y.items() <span style="color:#fff;font-weight:bold">if</span> k == <span style="color:#0ff;font-weight:bold">&#39;name&#39;</span>]
</span></span><span style="display:flex;"><span>            result = {}
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> entry in self._data:
</span></span><span style="display:flex;"><span>                name = extract_data(<span style="color:#0ff;font-weight:bold">&#39;name&#39;</span>, entry)
</span></span><span style="display:flex;"><span>                description = extract_data(<span style="color:#0ff;font-weight:bold">&#39;description&#39;</span>, entry)
</span></span><span style="display:flex;"><span>                resource = extract_data(<span style="color:#0ff;font-weight:bold">&#39;resource&#39;</span>, entry)
</span></span><span style="display:flex;"><span>                base_path = extract_data(<span style="color:#0ff;font-weight:bold">&#39;base&#39;</span>, entry)
</span></span><span style="display:flex;"><span>                self._named_routes.append(name)
</span></span><span style="display:flex;"><span>                endpoints = extract_data(<span style="color:#0ff;font-weight:bold">&#39;endpoints&#39;</span>, entry)
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">for</span> e in endpoints:
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">for</span> k, v in e.items():
</span></span><span style="display:flex;"><span>                        endpoint_name = <span style="color:#0ff;font-weight:bold">f</span><span style="color:#0ff;font-weight:bold">&#39;</span><span style="color:#0ff;font-weight:bold">{</span>stringcase.snakecase(k)<span style="color:#0ff;font-weight:bold">}</span><span style="color:#0ff;font-weight:bold">@</span><span style="color:#0ff;font-weight:bold">{</span>name<span style="color:#0ff;font-weight:bold">}</span><span style="color:#0ff;font-weight:bold">&#39;</span>
</span></span><span style="display:flex;"><span>                        result.update(<span style="color:#fff;font-weight:bold">dict</span>(
</span></span><span style="display:flex;"><span>                            endpoint=endpoint_name,
</span></span><span style="display:flex;"><span>                            operation=extract_data(<span style="color:#0ff;font-weight:bold">&#39;crud&#39;</span>, e),
</span></span><span style="display:flex;"><span>                            url_path=extract_data(<span style="color:#0ff;font-weight:bold">&#39;path&#39;</span>, e),
</span></span><span style="display:flex;"><span>                            methods=extract_data(<span style="color:#0ff;font-weight:bold">&#39;methods&#39;</span>, e),
</span></span><span style="display:flex;"><span>                            success=extract_data(<span style="color:#0ff;font-weight:bold">&#39;success&#39;</span>, e),
</span></span><span style="display:flex;"><span>                            error=extract_data(<span style="color:#0ff;font-weight:bold">&#39;error&#39;</span>, e),
</span></span><span style="display:flex;"><span>                            status=extract_data(<span style="color:#0ff;font-weight:bold">&#39;status&#39;</span>, e),
</span></span><span style="display:flex;"><span>                            payload=extract_data(<span style="color:#0ff;font-weight:bold">&#39;payload&#39;</span>, e)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                        route_entry = RouteEntry(name=name, path=base_path, resource=resource, description=description,
</span></span><span style="display:flex;"><span>                                                 **result)
</span></span><span style="display:flex;"><span>                        self._routes.append(route_entry)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> find(self, name: <span style="color:#fff;font-weight:bold">str</span> = <span style="color:#fff;font-weight:bold">None</span>, endpoint: <span style="color:#fff;font-weight:bold">str</span> = <span style="color:#fff;font-weight:bold">None</span>):
</span></span><span style="display:flex;"><span>        route_search = []
</span></span><span style="display:flex;"><span>        endpoint_search = []
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> name and not endpoint:
</span></span><span style="display:flex;"><span>            route_search = [x <span style="color:#fff;font-weight:bold">for</span> x in self._routes <span style="color:#fff;font-weight:bold">if</span> x.name == name]
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">elif</span> name and endpoint:
</span></span><span style="display:flex;"><span>            route_search = [x <span style="color:#fff;font-weight:bold">for</span> x in self._routes <span style="color:#fff;font-weight:bold">if</span> x.name == name and endpoint in x.endpoint]
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> endpoint and not name:
</span></span><span style="display:flex;"><span>            endpoint_search = [x <span style="color:#fff;font-weight:bold">for</span> x in self._routes <span style="color:#fff;font-weight:bold">if</span> x.endpoint == endpoint or endpoint in x.endpoint]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> route_search and not endpoint_search:
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> route_search[<span style="color:#ff0;font-weight:bold">0</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">elif</span> endpoint_search and not route_search:
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> endpoint_search[<span style="color:#ff0;font-weight:bold">0</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">elif</span> route_search and endpoint_search:
</span></span><span style="display:flex;"><span>            rsc_1 = endpoint_search[<span style="color:#ff0;font-weight:bold">0</span>]
</span></span><span style="display:flex;"><span>            rsc_2 = route_search[<span style="color:#ff0;font-weight:bold">0</span>]
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> rsc_1.endpoint == rsc_2.endpoint:
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span> rsc_1
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @property
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> routes(self):
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        Instance property of the list of routes registered in the application.
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        :return: A list of instances of RouteEntry for each registered route
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> self._routes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @property
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> keys(self):
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        Instance property of the list of base routes registered in the application
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        :return: list of named base routes
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> self._named_routes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @property
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> resources(self):
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        Provide a set of all named resources registered with the application routes
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        :return: a set of registered Resource names.
</span></span></span><span style="display:flex;"><span><span style="color:#0ff;font-weight:bold">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        rsc = (a.resource <span style="color:#fff;font-weight:bold">for</span> a in self._routes <span style="color:#fff;font-weight:bold">if</span> a.resource is not <span style="color:#fff;font-weight:bold">None</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">set</span>(rsc)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> RouteEntry:
</span></span><span style="display:flex;"><span>    __slots__ = <span style="color:#0ff;font-weight:bold">&#39;_path&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;_methods&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;_name&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;_success&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;_error&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;_status&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;_url_path&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;_payload&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#0ff;font-weight:bold">&#39;_url_query&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;_endpoint&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;_resource&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;_description&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;_tags&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;_operation&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;_schema&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> __init__(self, endpoint: <span style="color:#fff;font-weight:bold">str</span>, path: <span style="color:#fff;font-weight:bold">str</span>, methods: List, name: <span style="color:#fff;font-weight:bold">str</span>, success: <span style="color:#fff;font-weight:bold">str</span>, error: <span style="color:#fff;font-weight:bold">str</span>, status: <span style="color:#fff;font-weight:bold">int</span> | <span style="color:#fff;font-weight:bold">str</span>,
</span></span><span style="display:flex;"><span>                 url_path: <span style="color:#fff;font-weight:bold">str</span>, payload: Dict = <span style="color:#fff;font-weight:bold">None</span>, resource: <span style="color:#fff;font-weight:bold">str</span> = <span style="color:#fff;font-weight:bold">None</span>, description: <span style="color:#fff;font-weight:bold">str</span> = <span style="color:#fff;font-weight:bold">None</span>, tags: List = <span style="color:#fff;font-weight:bold">None</span>,
</span></span><span style="display:flex;"><span>                 operation: <span style="color:#fff;font-weight:bold">str</span> = <span style="color:#fff;font-weight:bold">None</span>, schema: Any | BaseModel = <span style="color:#fff;font-weight:bold">None</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">def</span> _validate_status(s):
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> <span style="color:#fff;font-weight:bold">isinstance</span>(s, <span style="color:#fff;font-weight:bold">int</span> | <span style="color:#fff;font-weight:bold">str</span>):
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> <span style="color:#fff;font-weight:bold">str</span>(s).isnumeric() and <span style="color:#ff0;font-weight:bold">100</span> &lt;= <span style="color:#fff;font-weight:bold">int</span>(s) &lt;= <span style="color:#ff0;font-weight:bold">600</span>:
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">def</span> _validate_payload(p):
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> <span style="color:#fff;font-weight:bold">isinstance</span>(p, List | Tuple):
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span> [z <span style="color:#fff;font-weight:bold">for</span> z in p <span style="color:#fff;font-weight:bold">for</span> x, _ in z.items() <span style="color:#fff;font-weight:bold">if</span> x in [<span style="color:#0ff;font-weight:bold">&#39;name&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;description&#39;</span>]]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">def</span> _validate_methods(m):
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> <span style="color:#fff;font-weight:bold">isinstance</span>(m, List | Tuple):
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span> [x <span style="color:#fff;font-weight:bold">for</span> x in m <span style="color:#fff;font-weight:bold">if</span> x in [<span style="color:#0ff;font-weight:bold">&#39;GET&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;POST&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;PUT&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;DELETE&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;HEAD&#39;</span>]]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">def</span> _validate_url_path(base_url, up):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            url = extract_data(<span style="color:#0ff;font-weight:bold">&#39;url&#39;</span>, up)
</span></span><span style="display:flex;"><span>            params = extract_data(<span style="color:#0ff;font-weight:bold">&#39;params&#39;</span>, up)
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> not base_url:
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">raise</span> ValueError(<span style="color:#0ff;font-weight:bold">&#39;Invalid base URL provided&#39;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> not url:
</span></span><span style="display:flex;"><span>                rsc = base_url
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>                rsc = base_url + url
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> params and <span style="color:#fff;font-weight:bold">isinstance</span>(params, List | Tuple):
</span></span><span style="display:flex;"><span>                pattern = <span style="color:#0ff;font-weight:bold">r</span><span style="color:#0ff;font-weight:bold">&#39;{(.*)}&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">for</span> p in params:
</span></span><span style="display:flex;"><span>                    path_variable = extract_data(<span style="color:#0ff;font-weight:bold">&#39;path&#39;</span>, p)
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">if</span> path_variable and <span style="color:#fff;font-weight:bold">isinstance</span>(path_variable, List | Tuple):
</span></span><span style="display:flex;"><span>                        <span style="color:#fff;font-weight:bold">for</span> x in path_variable:
</span></span><span style="display:flex;"><span>                            <span style="color:#fff;font-weight:bold">for</span> k, v in x.items():
</span></span><span style="display:flex;"><span>                                <span style="color:#fff;font-weight:bold">if</span> k == <span style="color:#0ff;font-weight:bold">&#39;name&#39;</span> and v:
</span></span><span style="display:flex;"><span>                                    <span style="color:#fff;font-weight:bold">if</span> re.search(pattern, rsc):
</span></span><span style="display:flex;"><span>                                        re.sub(pattern, <span style="color:#0ff;font-weight:bold">&#39;{</span><span style="color:#0ff;font-weight:bold">%s</span><span style="color:#0ff;font-weight:bold">}&#39;</span> % v, rsc)
</span></span><span style="display:flex;"><span>                                    <span style="color:#fff;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>                                        rsc += <span style="color:#0ff;font-weight:bold">&#39;/{</span><span style="color:#0ff;font-weight:bold">%s</span><span style="color:#0ff;font-weight:bold">}&#39;</span> % v
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> rsc
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">def</span> _validate_tags(t: List):
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> t:
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span> [x <span style="color:#fff;font-weight:bold">for</span> x in t <span style="color:#fff;font-weight:bold">if</span> <span style="color:#fff;font-weight:bold">isinstance</span>(x, <span style="color:#fff;font-weight:bold">str</span>)]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">def</span> _validate_operation(op: <span style="color:#fff;font-weight:bold">str</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> op in [<span style="color:#0ff;font-weight:bold">&#39;add&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;edit&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;delete&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;view&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;list&#39;</span>]:
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span> op
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self._endpoint = endpoint <span style="color:#fff;font-weight:bold">if</span> <span style="color:#fff;font-weight:bold">isinstance</span>(endpoint, <span style="color:#fff;font-weight:bold">str</span>) <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>        self._path = path <span style="color:#fff;font-weight:bold">if</span> <span style="color:#fff;font-weight:bold">isinstance</span>(path, <span style="color:#fff;font-weight:bold">str</span>) <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>        self._methods = _validate_methods(methods)
</span></span><span style="display:flex;"><span>        self._name = name <span style="color:#fff;font-weight:bold">if</span> <span style="color:#fff;font-weight:bold">isinstance</span>(name, <span style="color:#fff;font-weight:bold">str</span>) <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>        self._success = success <span style="color:#fff;font-weight:bold">if</span> <span style="color:#fff;font-weight:bold">isinstance</span>(success, <span style="color:#fff;font-weight:bold">str</span>) <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>        self._error = error <span style="color:#fff;font-weight:bold">if</span> <span style="color:#fff;font-weight:bold">isinstance</span>(error, <span style="color:#fff;font-weight:bold">str</span>) <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>        self._status = status <span style="color:#fff;font-weight:bold">if</span> _validate_status(status) <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>        self._url_path = _validate_url_path(urljoin(name, self._path), url_path)
</span></span><span style="display:flex;"><span>        self._payload = _validate_payload(payload)
</span></span><span style="display:flex;"><span>        self._resource = resource <span style="color:#fff;font-weight:bold">if</span> <span style="color:#fff;font-weight:bold">isinstance</span>(resource, <span style="color:#fff;font-weight:bold">str</span>) <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>        self._description = description <span style="color:#fff;font-weight:bold">if</span> <span style="color:#fff;font-weight:bold">isinstance</span>(description, <span style="color:#fff;font-weight:bold">str</span>) <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>        self._tags = _validate_tags(tags)
</span></span><span style="display:flex;"><span>        self._operation = _validate_operation(operation)
</span></span><span style="display:flex;"><span>        self._schema = schema
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @property
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> path(self):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> self._path
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @property
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> methods(self):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> self._methods
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @property
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> name(self):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> self._name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @property
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> success(self):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> self._success
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @property
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> error(self):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> self._error
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @property
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> status(self):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> self._status
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @property
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> url_path(self):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> self._url_path
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @property
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> payload(self):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> self._payload
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @property
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> endpoint(self):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> self._endpoint
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @property
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> resource(self):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> self._resource
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @property
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> description(self):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> self._description
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @property
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> tags(self):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> self._tags
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @property
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> crud_type(self):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> self._operation
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @property
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> schema(self):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> self._schema
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @schema.setter
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">def</span> schema(self, value):
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> <span style="color:#fff;font-weight:bold">isinstance</span>(value, (Dict, BaseModel)):
</span></span><span style="display:flex;"><span>            self._schema = value
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>base = os.getcwd()
</span></span><span style="display:flex;"><span>route_path = os.path.join(base, <span style="color:#0ff;font-weight:bold">&#39;routers&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;routers.yml&#39;</span>)
</span></span><span style="display:flex;"><span>app_routes = <span style="color:#fff;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">with</span> <span style="color:#fff;font-weight:bold">open</span>(route_path, <span style="color:#0ff;font-weight:bold">&#39;r&#39;</span>) <span style="color:#fff;font-weight:bold">as</span> fh:
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span>        data = yaml.safe_load(fh)
</span></span><span style="display:flex;"><span>        app_routes = AppRouter(data)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">except</span> yaml.YAMLError:
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">raise</span>
</span></span></code></pre></div>
    </div>
</div>




<p>The <code>AppRouter</code> class serves as a registry of all API endpoints for the system. This class defines three
parameters: <code>routes</code>, <code>keys</code>, and <code>resources</code>. The routes parameter returns a list of <code>RouteEntry</code> objects that holds
information (example name, URL, description etc.) about each route. The <code>keys</code> parameter gives a list of names that are
mapped to each route. The <code>resource</code> parameter provides a set of named resources (example <code>Order</code>) which are registered
in the system. The <code>__init__</code> function of the <code>AppRouter</code> class is where data read from <code>routes.yml</code> is parsed and added
to an internal list called <code>_data</code>. Each entry from the <code>routes.yml</code> file is parsed into an instance of <code>RouteEntry</code> by
extracting attributes (<code>description</code>, <code>resource</code>, <code>base</code>, <code>endpoints</code>, <code>name</code>) from the <code>routes.yml</code> data.</p>
<p>The find method of the <code>AppRouter</code> class is used to verify if a given named route exists within the defined list of
routes. This function can take a name or <code>endpoint</code> parameter. If only the <code>name</code> is given, then the search is based
only on the <code>name</code> assigned to a route as defined in <code>routes.yml</code>.</p>






    
    




<div class="position-relative">
    <div class="position-absolute" style="right:0;">
        <button class="btn btn-light" data-clipboard-target="#clipboard_28a9b90473">
        Copy
        </button>
    </div>
    <div id="clipboard_28a9b90473">
    <div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="font-weight:bold">route</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">name</span>: authentication
</span></span><span style="display:flex;"><span>    description:This resource will manage user activities associated with registration, login, logout, and password reset.
</span></span></code></pre></div>
    </div>
</div>










    
    




<div class="position-relative">
    <div class="position-absolute" style="right:0;">
        <button class="btn btn-light" data-clipboard-target="#clipboard_df4d2b1671">
        Copy
        </button>
    </div>
    <div id="clipboard_df4d2b1671">
    <div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; app_routes.find(name=<span style="color:#0ff;font-weight:bold">&#39;authentication&#39;</span>)
</span></span><span style="display:flex;"><span>&lt;routers.RouteEntry object at 0x7f45e52d4860&gt;
</span></span></code></pre></div>
    </div>
</div>




<p>If only the endpoint is given then the search is based on the name of the function registered against the route.</p>






    
    




<div class="position-relative">
    <div class="position-absolute" style="right:0;">
        <button class="btn btn-light" data-clipboard-target="#clipboard_8c7f02a0c0">
        Copy
        </button>
    </div>
    <div id="clipboard_8c7f02a0c0">
    <div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="font-weight:bold">route</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">name</span>: authentication
</span></span><span style="display:flex;"><span>    description:This resource will manage user activities associated with registration, login, logout, and password reset.
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">base</span>: /authentication
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">endpoints</span>:
</span></span><span style="display:flex;"><span>      - <span style="font-weight:bold">access token</span>: 
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">methods</span>: [<span style="color:#0ff;font-weight:bold">&#39;POST&#39;</span>]
</span></span></code></pre></div>
    </div>
</div>










    
    




<div class="position-relative">
    <div class="position-absolute" style="right:0;">
        <button class="btn btn-light" data-clipboard-target="#clipboard_5658559487">
        Copy
        </button>
    </div>
    <div id="clipboard_5658559487">
    <div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; app_routes.find(endpoint=<span style="color:#0ff;font-weight:bold">&#39;access_token&#39;</span>)
</span></span><span style="display:flex;"><span>&lt;routers.RouteEntry object at 0x7f45e52d4860&gt;
</span></span></code></pre></div>
    </div>
</div>




<p>Notice that the endpoint is specified without spaces as this closely matches a function name in Python. Searches can
also be done by specifying the named route to which the function is assigned using the <code>@</code> symbol.</p>






    
    




<div class="position-relative">
    <div class="position-absolute" style="right:0;">
        <button class="btn btn-light" data-clipboard-target="#clipboard_eae6bf5770">
        Copy
        </button>
    </div>
    <div id="clipboard_eae6bf5770">
    <div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; app_routes.find(endpoint=<span style="color:#0ff;font-weight:bold">&#39;access_token@otp&#39;</span>)
</span></span><span style="display:flex;"><span>&lt;routers.RouteEntry object at 0x7f45e52d4860&gt;
</span></span></code></pre></div>
    </div>
</div>




<p>From the returned RouteEntry object, we can access information such as HTTP methods supported by calling property
methods; the name of the route by calling name; the type of CRUD (Create Read Update Delete) operation supported at this
API endpoint by calling <code>crud_type</code>; the description; the path and many other properties as defined in <code>RouteEntry</code>.
More importantly, we can register routes in logical groups without the need of typing all entries manually.</p>






    
    




<div class="position-relative">
    <div class="position-absolute" style="right:0;">
        <button class="btn btn-light" data-clipboard-target="#clipboard_8cfbcb34a9">
        Copy
        </button>
    </div>
    <div id="clipboard_8cfbcb34a9">
    <div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py3" data-lang="py3"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> authentication.services.jwt_handler <span style="color:#fff;font-weight:bold">import</span> user_login, user_logout, user_signup
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> authentication.services.otp <span style="color:#fff;font-weight:bold">import</span> verify_login_otp, generate_login_otp
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> permissions <span style="color:#fff;font-weight:bold">import</span> Permission
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> routers <span style="color:#fff;font-weight:bold">import</span> app_routes
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> routers.api <span style="color:#fff;font-weight:bold">import</span> InferringSchemaRouter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Define the various ACL for catalogue services as scopes.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>acl = Permission()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>service = <span style="color:#0ff;font-weight:bold">&#39;Services&#39;</span>
</span></span><span style="display:flex;"><span>prefix = <span style="color:#0ff;font-weight:bold">&#39;organization&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>auth_router = InferringSchemaRouter()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>r1 = app_routes.find(endpoint=<span style="color:#0ff;font-weight:bold">&#39;user_login&#39;</span>)
</span></span><span style="display:flex;"><span>r2 = app_routes.find(endpoint=<span style="color:#0ff;font-weight:bold">&#39;user_logout&#39;</span>)
</span></span><span style="display:flex;"><span>r3 = app_routes.find(endpoint=<span style="color:#0ff;font-weight:bold">&#39;user_signup&#39;</span>)
</span></span><span style="display:flex;"><span>r4 = app_routes.find(endpoint=<span style="color:#0ff;font-weight:bold">&#39;verify_login_otp&#39;</span>)
</span></span><span style="display:flex;"><span>r5 = app_routes.find(endpoint=<span style="color:#0ff;font-weight:bold">&#39;generate_login_otp&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># Match routes to functions </span>
</span></span><span style="display:flex;"><span>add_auth_routes = [
</span></span><span style="display:flex;"><span>    (r1, user_login),
</span></span><span style="display:flex;"><span>    (r2, user_logout),
</span></span><span style="display:flex;"><span>    (r3, user_signup),
</span></span><span style="display:flex;"><span>    (r4, verify_login_otp),
</span></span><span style="display:flex;"><span>    (r5, generate_login_otp)
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f"># dynamically add routes to instance of APIRouter using loaded RouteEntry objects</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">for</span> entry in add_auth_routes:
</span></span><span style="display:flex;"><span>    r, e = entry
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> r:
</span></span><span style="display:flex;"><span>        auth_router.add_api_route(r.url_path, endpoint=e, description=r.description,
</span></span><span style="display:flex;"><span>                                  status_code=r.status, methods=r.methods, response_description=r.success,
</span></span><span style="display:flex;"><span>                                  name=r.endpoint)
</span></span></code></pre></div>
    </div>
</div>




<p>The routes <code>r1</code> to <code>r5</code> are mapped to functions <code>user_login</code>, <code>user_logout</code>, <code>user_signup</code>, <code>verify_login_otp</code>,
and <code>generate_login_otp</code> as a list of tuples. This list is then iterated and each route and entry added to the
specified <code>APIRouter</code> instance. This way, defined routes can be managed from a centralised <code>routes.yml</code> file and changes
to the routes or associated parameter is automatically reflected in the system on reboot or start up.</p>


    


                    
                    <div class="row"><div class="position-relative mx-auto col-lg-9">
                          
<div class="bg-primary overflow-hidden p-3 mt-5 shadow">

    <h4 class="text-white text-center">Read more</h4>

    <div class="d-flex justify-content-center"><a class="p-1 mr-3 d-inline-block text-white" href="/100_pages_fastapi/chapter2/" title="The mWallet Project"><i class="fas fa-chevron-left p-1"></i>The mWallet Project</a>
        <a class="p-1 ml-3 d-inline-block text-white text-right" href="/100_pages_fastapi/chapter4/" title="Application services">Application services<i class="fas fa-chevron-right p-1"></i></a>
    </div>
</div>


                        </div></div> 

                </div>

            </div> 

        </div> 
<script src="https://frier17.github.io/100_pages_fastapi/lib/jquery.min.js"></script> 
<script src="https://frier17.github.io/100_pages_fastapi/lib/popper.min.js"></script> 

<script src="https://frier17.github.io/100_pages_fastapi/js/bootstrap.min.js"></script> 


<script type="text/javascript" src="/100_pages_fastapi/plugins/lunr.min.js"></script>
<script type="text/javascript" src="/100_pages_fastapi/plugins/auto-complete.js"></script>
<link href="/100_pages_fastapi/plugins/auto-complete.css" rel="stylesheet">
<script type="text/javascript">
  
      var baseurl = "https:\/\/frier17.github.io\/100_pages_fastapi\/";
  
</script>
<script type="text/javascript" src="/100_pages_fastapi/plugins/search.js"></script>

<script type="text/javascript" src="/100_pages_fastapi/plugins/favorites.js"></script>


<script type="text/javascript" src="/100_pages_fastapi/plugins/clipboard.js"></script>
<script>
  new ClipboardJS('.btn');
</script>
</body>
</html>
